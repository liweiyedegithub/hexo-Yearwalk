---
title: 麒麟V10 SP3 (x86 架构)防火墙关闭命令踩坑记录
date: 2024-04-02 10:14:56
tags: 
  - Docker
  - 麒麟V10
  - 防火墙
top: false
categories: 
  - 困难解决
  - 国产操作系统
  - 踩坑
img: /medias/featureimages/17.jpg

---
# 麒麟V10 SP3 (x86 架构)防火墙关闭命令踩坑记录

------------------------------------------------------------------------

## 一、问题背景

在日常运维过程中，需要临时关闭防火墙以便进行端口调试和服务联调。按照常规操作，执行关闭防火墙命令后，期望立即生效。然而在麒麟
V10 SP3 x86
系统上发现，**命令执行后防火墙状态仍为开启**，相关端口依然被阻断，必须**重启系统后才真正关闭**。

------------------------------------------------------------------------

## 二、复现过程

执行以下命令：

``` bash
# 关闭防火墙
systemctl stop firewalld

# 禁止开机启动
systemctl disable firewalld

# 查看防火墙状态
systemctl status firewalld
```

输出结果显示服务已停止，但使用以下命令验证时：

``` bash
firewall-cmd --state
```

依然返回：

    running

或者端口访问依旧被阻断，说明防火墙规则仍在生效。

------------------------------------------------------------------------

## 三、原因分析

经排查发现： - 麒麟 V10 SP3 在某些 **x86 版本的内核模块**
下，`firewalld` 服务虽然被停止，但 **iptables/nftables
的内核规则未被即时卸载**； - 此时即使 `systemctl`
显示服务已停，规则依旧保留在内核空间； -
重启后系统初始化阶段未加载相关规则，才真正生效。

------------------------------------------------------------------------

## 四、解决方案与验证

**方案一：彻底清空规则后再停服务**

``` bash
# 停止防火墙服务
systemctl stop firewalld

# 清空规则
iptables -F
iptables -X
iptables -Z

# 或者使用 nftables 清空
nft flush ruleset
```

**方案二：重启系统确保完全关闭**

``` bash
reboot
```

重启后再次验证：

``` bash
firewall-cmd --state
```

返回：

    not running

并且端口可正常访问。

------------------------------------------------------------------------

## 五、经验总结

1.  麒麟 V10 系统的防火墙管理机制与 Red Hat
    系列略有差异，内核规则可能残留；
2.  仅通过 `systemctl stop firewalld` 并不总能立即生效；
3.  若遇到关闭命令无效，建议：
    -   手动清空规则；
    -   或执行一次系统重启；
4.  在自动化脚本中应考虑此类情况，加入防火墙状态验证逻辑。

------------------------------------------------------------------------

## ✅ 附：常用防火墙命令汇总

  功能                   命令

---------------------- ---------------------------------------------

  查看状态               `systemctl status firewalld`
  停止防火墙             `systemctl stop firewalld`
  禁止开机启动           `systemctl disable firewalld`
  启动防火墙             `systemctl start firewalld`
  重启防火墙             `systemctl restart firewalld`
  查看状态（简洁输出）   `firewall-cmd --state`
  清空 iptables 规则     `iptables -F && iptables -X && iptables -Z`
  清空 nftables 规则     `nft flush ruleset`